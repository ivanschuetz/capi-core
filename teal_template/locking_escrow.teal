#pragma version 4
// int 1

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Identification
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

global GroupSize
int 10
==
bnz branch_project_setup

global GroupSize
int 2
==
bz not_group_size_2
gtxn 0 TypeEnum // unlock shares
int appl
==
int CloseOut 
gtxn 0 OnCompletion // central opt out (TODO app ids?)
==
&&
gtxn 1 TypeEnum // unlock shares
int axfer
==
&&
bnz branch_unlock
not_group_size_2:

b failure

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Handling
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

branch_project_setup:
gtxn 5 XferAsset
int {shares_asset_id}
==
gtxn 5 TypeEnum
int axfer
==
&&
gtxn 5 AssetAmount
int 0
==
&&
gtxn 5 Fee
int 1000
<=
&&
gtxn 5 RekeyTo
global ZeroAddress
==
&&
gtxn 5 AssetCloseTo
global ZeroAddress
==
&&
return

branch_unlock:
gtxn 0 TypeEnum
int appl
==
gtxn 1 TypeEnum
int axfer
==
&&
return

failure:
int 0
return
