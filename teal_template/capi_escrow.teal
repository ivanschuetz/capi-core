#pragma version 4
// int 1

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Identification
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

global GroupSize
int 3
==
bnz branch_setup

global GroupSize
int 2 // central optout + unlock shares
==
bz not_group_size_2

gtxn 0 TypeEnum 
int appl
==
gtxn 0 NumAppArgs
int 1
==
&&
bz not_unlock
gtxn 0 ApplicationArgs 0
byte b64 dW5sb2Nr // unlock
==
int CloseOut 
gtxn 0 OnCompletion // central opt out (TODO app ids?)
==
&&
gtxn 1 TypeEnum // unlock shares
int axfer
==
&&
bnz branch_unlock
not_unlock:

b branch_harvest

not_group_size_2:

b failure

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// Handling
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

branch_setup:
b success

branch_harvest:
b success

branch_unlock:
b success

success:
int 1
return

failure:
int 0
return
